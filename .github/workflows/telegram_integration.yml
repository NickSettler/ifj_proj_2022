name: Telegram Integration
on:
  pull_request_target:
    types: [ assigned, review_requested ]
  issues:
    types: [ assigned ]
  push:
    branches:
      - "*"

jobs:
  send_pr_assigned:
    runs-on: ubuntu-latest
    if: (github.event_name == 'pull_request_target' && github.event.action == 'assigned') || (github.event_name == 'push')
    steps:
      - name: Get user Telegram ID
        env:
          TELEGRAM_USERS: ${{ secrets.TELEGRAM_USERS }}
        run: |
          IFS=', ' read -r -a users <<< "$TELEGRAM_USERS"
          target_username="${{ github.event.assignee.login }}"
          for user in "${users[@]}"; do
              IFS=':' read -r -a user <<< "$user"
              if [ "${{ github.event.assignee.login }}" == "${user[0]}" ]; then
                  target_username="${user[1]}"
                  break
              fi
          done
          echo "target_username=$target_username" >> $GITHUB_ENV
      - name: Send Telegram Message
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: |
            ðŸ‘‹ Hi, @${{ env.TARGET_USERNAME }}! 

            You have been assigned to [${{ github.event.pull_request.title }}](${{ github.event.pull_request.html_url }}) in [${{ github.repository }}](${{ github.event.pull_request.html_url }}).